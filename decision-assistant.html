<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç»´åº¦å†³ç­–åˆ†æä¸“å®¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #1d4ed8 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .expertise-tags {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .expertise-tag {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .expertise-tag strong {
            display: block;
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Chat Area */
        .chat-area {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header h2 {
            font-size: 1.1rem;
            color: var(--text);
        }

        .round-badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .round-badge.round-1 { background: var(--success); }
        .round-badge.round-2 { background: var(--warning); }
        .round-badge.round-3 { background: var(--danger); }

        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.system {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 0 12px 12px 0;
        }

        .message.user {
            background: #f1f5f9;
            padding: 16px 20px;
            border-radius: 12px;
            margin-left: 20px;
        }

        .message-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .message-content {
            white-space: pre-wrap;
        }

        .message-content ul {
            margin: 10px 0;
            padding-left: 24px;
        }

        .message-content li {
            margin: 6px 0;
        }

        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.9rem;
        }

        .message-content th,
        .message-content td {
            border: 1px solid var(--border);
            padding: 10px 12px;
            text-align: left;
        }

        .message-content th {
            background: #f1f5f9;
            font-weight: 600;
        }

        /* Input Area */
        .input-area {
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
        }

        .input-wrapper input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .input-wrapper input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-wrapper button {
            padding: 14px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .input-wrapper button:hover {
            background: var(--primary-light);
        }

        .input-wrapper button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .card h3 {
            font-size: 1rem;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card h3 .icon {
            font-size: 1.2rem;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* Report Actions */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .action-btn.primary:hover {
            background: var(--primary-light);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Thought Chain Visualization */
        .thought-chain {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }

        .thought-chain .keyword {
            color: #fbbf24;
        }

        .thought-chain .highlight {
            color: #34d399;
        }

        .thought-chain .warning {
            color: #f87171;
        }

        .thought-chain .comment {
            color: #94a3b8;
        }

        /* Recommendation Box */
        .recommendation-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .recommendation-box h4 {
            color: #92400e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Matrix Table */
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.85rem;
        }

        .matrix-table th,
        .matrix-table td {
            border: 1px solid var(--border);
            padding: 10px 8px;
            text-align: center;
        }

        .matrix-table th {
            background: #f1f5f9;
            font-weight: 600;
        }

        .matrix-table .good { background: #dcfce7; color: #166534; }
        .matrix-table .medium { background: #fef9c3; color: #854d0e; }
        .matrix-table .bad { background: #fee2e2; color: #991b1b; }

        /* Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 16px 0;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .timeline-time {
            font-size: 0.8rem;
            color: var(--text-light);
            min-width: 60px;
        }

        .timeline-content {
            flex: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                padding: 24px 16px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .chat-messages {
                height: 400px;
            }
        }

        /* Loading Animation */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        /* Diff highlight */
        .updated {
            background: #fef9c3;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ğŸ¯ å†³ç­–åˆ†æä¸“å®¶</h1>
            <p>88ä¸ªä¸“ä¸šå†³ç­–æ¨¡å‹ Â· 4å¤§é¢†åŸŸè¦†ç›–</p>
            <div class="expertise-tags">
                <div class="expertise-tag">
                    <strong>ğŸ¦ CPA</strong>
                    æˆæœ¬æ”¶ç›Šåˆ†æ
                </div>
                <div class="expertise-tag">
                    <strong>ğŸ“ˆ CFA</strong>
                    æŠ•èµ„é£é™©è¯„ä¼°
                </div>
                <div class="expertise-tag">
                    <strong>ğŸ“Š CMA</strong>
                    æˆ˜ç•¥ç»©æ•ˆç®¡ç†
                </div>
                <div class="expertise-tag">
                    <strong>âš–ï¸ æ³•è€ƒ</strong>
                    æ³•å¾‹é£é™©è¯†åˆ«
                </div>
            </div>
        </header>

        <div class="main-grid">
            <!-- Chat Area -->
            <main class="chat-area">
                <div class="chat-header">
                    <h2>ğŸ’¬ å¯¹è¯åˆ†æ</h2>
                    <span class="round-badge" id="roundBadge">ç­‰å¾…å¼€å§‹</span>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be inserted here -->
                </div>
                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="userInput" placeholder="è¯·æè¿°æ‚¨çš„å†³ç­–å›°å¢ƒ..." disabled>
                        <button id="sendBtn" onclick="sendMessage()" disabled>å‘é€</button>
                    </div>
                </div>
            </main>

            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Knowledge Base Stats -->
                <div class="card highlight">
                    <h3><span class="icon">ğŸ“š</span> çŸ¥è¯†åº“</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">88</div>
                            <div class="stat-label">å†³ç­–æ¨¡å‹</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">4</div>
                            <div class="stat-label">ä¸“ä¸šé¢†åŸŸ</div>
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="card">
                    <h3><span class="icon">ğŸ“ˆ</span> åˆ†æç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="questionCount">0</div>
                            <div class="stat-label">å·²å›ç­”é—®é¢˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="domainCount">0</div>
                            <div class="stat-label">åˆ†æé¢†åŸŸ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="optionCount">0</div>
                            <div class="stat-label">è¯„ä¼°é€‰é¡¹</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="roundCount">0</div>
                            <div class="stat-label">åˆ†æè½®æ¬¡</div>
                        </div>
                    </div>
                </div>

                <!-- Report Actions -->
                <div class="card">
                    <h3><span class="icon">ğŸ“„</span> æŠ¥å‘Šæ“ä½œ</h3>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="downloadReport()" id="downloadBtn" disabled>
                            ğŸ“¥ ä¸‹è½½HTMLæŠ¥å‘Š
                        </button>
                        <button class="action-btn" onclick="copyReport()" id="copyBtn" disabled>
                            ğŸ“‹ å¤åˆ¶æŠ¥å‘Šæ–‡æœ¬
                        </button>
                        <button class="action-btn primary" onclick="startOver()" id="restartBtn">
                            ğŸ”„ é‡æ–°å¼€å§‹
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // Application State
        let state = {
            round: 0,
            currentPhase: 'intro',
            questions: [],
            userAnswers: [],
            analysis: {
                round1: null,
                round2: null,
                round3: null
            },
            options: [],
            reportData: []
        };

        // Knowledge Base Content
        const knowledgeBase = {
            cpa: {
                name: 'CPA è´¢åŠ¡åˆ†æ',
                models: ['æˆæœ¬æ•ˆç›Šåˆ†æ', 'æ˜¾æ€§/éšæ€§æˆæœ¬äºŒåˆ†æ³•', 'æŠ˜ç°æ¨¡å‹', 'æœé‚¦åˆ†æ'],
                icon: 'ğŸ¦'
            },
            cfa: {
                name: 'CFA æŠ•èµ„å¿ƒç†',
                models: ['è¡Œä¸ºé‡‘èå­¦', 'å¿ƒç†åå·®æ£€æµ‹', 'é£é™©æ”¶ç›Šæƒè¡¡', 'ç»„åˆç†è®º'],
                icon: 'ğŸ“ˆ'
            },
            cma: {
                name: 'CMA ç®¡ç†ä¼šè®¡',
                models: ['SWOTåˆ†æ', 'æ³¢ç‰¹äº”åŠ›', 'å¹³è¡¡è®¡åˆ†å¡', 'æˆ˜ç•¥åœ°å›¾'],
                icon: 'ğŸ“Š'
            },
            law: {
                name: 'æ³•è€ƒ æ³•å¾‹æ€ç»´',
                models: ['ä¸‰æ®µè®ºæ¨ç†', 'è¯æ®åˆ†æ', 'é£é™©è¯†åˆ«', 'åº•çº¿æ€ç»´'],
                icon: 'âš–ï¸'
            }
        };

        // Introduction Message
        const introMessage = `
## ğŸ¯ å†³ç­–åˆ†æä¸“å®¶ - ä½ çš„ç§äººå†³ç­–é¡¾é—®

---

### ğŸ¤” ä½ æ˜¯å¦ä¹Ÿæœ‰è¿™äº›å›°æ‰°ï¼Ÿ

- è·³æ§½è¿˜æ˜¯ç•™ä¸‹ï¼Ÿåå¤çº ç»“å´è¶Šæƒ³è¶Šä¹±
- ä¹°æˆ¿è¿˜æ˜¯ç§Ÿæˆ¿ï¼Ÿæ€•åƒäºåˆæ€•åæ‚”
- æŠ•èµ„è¿˜æ˜¯å­˜é’±ï¼Ÿè·Ÿé£æ“ä½œæ€»æ˜¯è¢«å¥—

**åˆ«å†å‡­æ„Ÿè§‰åšå†³å®šï¼**

---

### ğŸ’¡ æˆ‘èƒ½å¸®ä½ åšä»€ä¹ˆ

æˆ‘æ˜¯**å¤šç»´åº¦è·¨ç•Œå†³ç­–åˆ†æä¸“å®¶**ï¼Œç”¨ **CPA / CFA / CMA / æ³•è€ƒ** å››å¤§é¢†åŸŸçš„ä¸“ä¸šæ¡†æ¶ï¼Œå¸®ä½ ç³»ç»Ÿåˆ†æï¼Œç†æ€§å†³ç­–ã€‚

| é¢†åŸŸ | æˆ‘èƒ½å¸®ä½ åˆ†æ |
|------|--------------|
| ğŸ¦ **CPA** | æˆæœ¬æ”¶ç›Šã€æœºä¼šæˆæœ¬ã€NPVå‡€ç°å€¼ |
| ğŸ“ˆ **CFA** | æŠ•èµ„é£é™©ã€å¿ƒç†åå·®ã€èµ„äº§é…ç½® |
| ğŸ“Š **CMA** | æˆ˜ç•¥å®šä½ã€ç»©æ•ˆç®¡ç†ã€SWOTåˆ†æ |
| âš–ï¸ **æ³•è€ƒ** | é£é™©åº•çº¿ã€æƒåˆ©ä¹‰åŠ¡ã€è¯æ®æ€ç»´ |

### ğŸ”‘ 88ä¸ªä¸“ä¸šå†³ç­–æ¨¡å‹

- æœºä¼šæˆæœ¬ Â· è¾¹é™…åˆ†æ Â· æ•æ„Ÿæ€§åˆ†æ
- æŸå¤±åŒæ¶ Â· é”šå®šæ•ˆåº” Â· ä»ä¼—åå·®
- ç›ˆäºå¹³è¡¡ Â· æ æ†æ•ˆåº” Â· å®‰å…¨è¾¹é™…
- ä¸‰æ®µè®ºæ¨ç† Â· é£é™©åˆ†é… Â· ç¨‹åºæ­£ä¹‰

### ğŸ¯ æˆ‘çš„ç‹¬ç‰¹ä»·å€¼

âœ… **ä¸åªæ˜¯ç»™ç»“è®º** - å±•ç¤ºå®Œæ•´æ€ç»´æ¨å¯¼è¿‡ç¨‹

âœ… **4ä¸ªç»´åº¦å¹¶è¡Œ** - è´¢åŠ¡/æŠ•èµ„/æˆ˜ç•¥/æ³•å¾‹å…¨è¦†ç›–

âœ… **88ä¸ªä¸“ä¸šæ¨¡å‹** - æ¯ä¸ªç»“è®ºéƒ½æœ‰æ¨¡å‹æ”¯æ’‘

âœ… **è‹æ ¼æ‹‰åº•å¼æé—®** - å¸®ä½ æ¾„æ¸…çœŸæ­£çš„éœ€æ±‚

---

**è¯·é—®ï¼Œæ‚¨ç›®å‰é¢ä¸´ä»€ä¹ˆå†³ç­–å›°å¢ƒæˆ–çº ç»“ç‚¹ï¼Ÿ**
        `;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            addMessage('system', 'å†³ç­–åˆ†æä¸“å®¶', introMessage);
            updateUI();

            // Enter key to send
            document.getElementById('userInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        });

        function addMessage(type, title, content) {
            const messages = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;
            msgDiv.innerHTML = `<div class="message-title">${title}</div><div class="message-content">${content}</div>`;
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function updateUI() {
            const input = document.getElementById('userInput');
            const sendBtn = document.getElementById('sendBtn');
            const badge = document.getElementById('roundBadge');

            // Enable input after intro
            if (state.round >= 0) {
                input.disabled = false;
                sendBtn.disabled = false;
                input.placeholder = 'è¯·æè¿°æ‚¨çš„å†³ç­–å›°å¢ƒ...';
            }

            // Update round badge
            const roundNames = ['ç­‰å¾…å¼€å§‹', 'é—®é¢˜ç¡®è®¤', 'æ·±åº¦åˆ†æ', 'è¿­ä»£ä¼˜åŒ–'];
            badge.textContent = roundNames[Math.min(state.round, 3)];
            badge.className = `round-badge round-${state.round}`;

            // Update steps
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                if (i === state.round) step.classList.add('active');
                if (i < state.round) step.classList.add('completed');
            }

            // Update stats
            document.getElementById('questionCount').textContent = state.questions.length;
            document.getElementById('domainCount').textContent = '4';
            document.getElementById('optionCount').textContent = state.options.length || '-';
            document.getElementById('roundCount').textContent = state.round >= 2 ? '1' : '0';
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addMessage('user', 'ä½ ', message);
            input.value = '';

            // Process based on round
            setTimeout(() => {
                processRound(message);
            }, 500);
        }

        function processRound(message) {
            if (state.round === 0) {
                // User describes problem
                state.round = 1;
                state.currentPhase = 'question';
                state.problem = message;
                addMessage('system', 'ğŸ’¡ åˆ†æè¿›åº¦', generateQuestionRound(message));
                addThinkingIndicator();
            } else if (state.round === 1) {
                // User answers questions
                state.questions.push(message);
                state.currentPhase = 'answering';

                // Check if enough questions answered
                if (state.questions.length >= 3) {
                    state.round = 2;
                    state.currentPhase = 'analysis';
                    addMessage('system', 'ğŸ“Š åˆ†æè¿›åº¦', generateAnalysisRound(state.questions));
                    document.getElementById('downloadBtn').disabled = false;
                    document.getElementById('copyBtn').disabled = false;
                } else {
                    addMessage('system', 'ğŸ’¡ ç»§ç»­ç¡®è®¤', generateMoreQuestions(state.questions.length));
                }
            } else if (state.round === 2) {
                // User has questions/updates
                state.round = 3;
                state.currentPhase = 'iteration';
                addMessage('system', 'ğŸ”„ åˆ†æè¿›åº¦', generateIterationRound(message));
            } else {
                // Further iterations
                addMessage('system', 'ğŸ”„ åˆ†æè¿›åº¦', generateIterationRound(message));
            }

            updateUI();
        }

        function addThinkingIndicator() {
            const messages = document.getElementById('chatMessages');
            const indicator = document.createElement('div');
            indicator.id = 'thinking';
            indicator.className = 'message system';
            indicator.innerHTML = `
                <div class="message-title">ğŸ§  æ€ç»´é“¾å¯è§†åŒ–</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                    <span style="color: var(--text-light);">æ­£åœ¨åŠ è½½çŸ¥è¯†åº“...</span>
                </div>
            `;
            messages.appendChild(indicator);
            messages.scrollTop = messages.scrollHeight;

            // Remove and continue
            setTimeout(() => {
                indicator.remove();
            }, 1500);
        }

        function generateQuestionRound(problem) {
            return `
## ğŸ¤” ROUND 1ï¼šé—®é¢˜ç¡®è®¤

æ„Ÿè°¢æè¿°ï¼ä¸ºç¡®ä¿åˆ†æå‡†ç¡®ï¼Œè¯·å…ˆç¡®è®¤ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

**æ ¸å¿ƒé—®é¢˜ï¼š** ${extractCoreProblem(problem)}

**å¾…ç¡®è®¤äº‹é¡¹ï¼š**

### ä¸€ã€è´¢åŠ¡ä¸æ—¶é—´ç»´åº¦

1. **ç›®å‰ç»æµçŠ¶å†µ**
   - å®¶åº­æœˆæ”¯å‡ºå¤šå°‘ï¼Ÿå­˜æ¬¾èƒ½æ”¯æ’‘å¤šä¹…æ— æ”¶å…¥ï¼Ÿ
   - å¤§é¢æ”¯å‡ºï¼ˆå¦‚ä½“åˆ¶å†…æ‰“ç‚¹è´¹ç”¨ï¼‰å¯¹å®¶åº­å‹åŠ›å¤§å—ï¼Ÿ

2. **æ—¶é—´çª—å£**
   - å¤‡å­•/ç”Ÿè‚²è®¡åˆ’çš„æ—¶é—´é¢„æœŸæ˜¯æ€æ ·çš„ï¼Ÿ
   - "æœä¹æ™šäº”"æ˜¯è¿‘æœŸåˆšéœ€è¿˜æ˜¯è¿œæœŸæœŸæœ›ï¼Ÿ

### äºŒã€èŒä¸šå‘å±•

3. **ä½“åˆ¶å†…æœºä¼šè¯¦æƒ…**
   - å…·ä½“ä»€ä¹ˆå•ä½ï¼Ÿï¼ˆå›½ä¼/äº‹ä¸šç¼–/å…¬åŠ¡å‘˜ï¼‰
   - å…³ç³»å¤šç¡¬ï¼Ÿè´¹ç”¨æ˜¯"å¿…é¡»èŠ±"è¿˜æ˜¯"å¯èƒ½éœ€è¦æ‰“ç‚¹"ï¼Ÿ

4. **èŒä¸šåº•çº¿**
   - å¦‚æœç»§ç»­åœ¨åŸå…¬å¸ï¼ŒæŠ€èƒ½ä¼šä¸ä¼šå½»åº•è’åºŸï¼Ÿ
   - å¯¹ç°æœ‰è¡Œä¸š/å²—ä½è¿˜æœ‰å¤šå¤§çƒ­æƒ…ï¼Ÿ

### ä¸‰ã€é£é™©åå¥½

5. **æ±‚èŒç«äº‰åŠ›**
   - ç›®å‰æ±‚èŒè¿›å±•å¦‚ä½•ï¼Ÿä¸»è¦å¡åœ¨å“ªé‡Œï¼Ÿ
   - æ˜¯å¦è€ƒè™‘è¿‡é™çº§æ±‚èŒ/è½¬è¡Œï¼Ÿ

6. **å†³ç­–é£æ ¼**
   - å®¶å±æ˜¯æ„¿æ„å†’é™©æ‹¼ä¸€æŠŠï¼Œè¿˜æ˜¯æ±‚ç¨³ä¼˜å…ˆï¼Ÿ
   - æ›´çœ‹é‡"ç¡®å®šæ€§"è¿˜æ˜¯"æˆé•¿æ€§"ï¼Ÿ

---

*è¯·å›ç­”ä»¥ä¸Šé—®é¢˜ï¼ˆè‡³å°‘3ä¸ªï¼‰ï¼Œç¡®è®¤åå°†è¿›å…¥å¤šé¢†åŸŸæ·±åº¦åˆ†æã€‚*
            `;
        }

        function generateMoreQuestions(count) {
            const templates = [
                `
### è¿˜éœ€è¦ç¡®è®¤ï¼š

**è´¢åŠ¡æ–¹é¢ï¼š**
- ç›®å‰å®¶åº­æ”¶å…¥å’Œå­˜æ¬¾æƒ…å†µå¦‚ä½•ï¼Ÿèƒ½å¦æ‰¿å—çŸ­æœŸæ— æ”¶å…¥ï¼Ÿ

**æ—¶é—´æ–¹é¢ï¼š**
- è¿™ä¸ªå†³ç­–çš„ç´§è¿«ç¨‹åº¦å¦‚ä½•ï¼Ÿæ˜¯å¦æœ‰æ˜ç¡®çš„æ—¶é—´é™åˆ¶ï¼Ÿ

**å¤‡é€‰æ–¹æ¡ˆï¼š**
- å¦‚æœAè®¡åˆ’å¤±è´¥ï¼Œæœ‰æ²¡æœ‰Bè®¡åˆ’å…œåº•ï¼Ÿ
                `,
                `
### å†è¡¥å……å‡ ä¸ªå…³é”®ç‚¹ï¼š

**é£é™©è¯„ä¼°ï¼š**
- æœ€å¤§çš„é£é™©ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæœ€åæƒ…å†µå‘ç”Ÿï¼Œèƒ½å¦æ‰¿å—ï¼Ÿ

**å®¶åº­å› ç´ ï¼š**
- ä¼´ä¾£/å®¶äººå¯¹è¿™ä¸ªå†³ç­–çš„æ€åº¦æ˜¯ä»€ä¹ˆï¼Ÿ

**å¿ƒç†çŠ¶æ€ï¼š**
- ç›®å‰æœ€å¤§çš„ç„¦è™‘æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿ
                `
            ];
            return templates[count % templates.length];
        }

        function generateAnalysisRound(answers) {
            return `
# å†³ç­–åˆ†ææŠ¥å‘Š

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

**æ ¸å¿ƒçŸ›ç›¾ï¼š** ${extractCoreProblem(state.problem)}

**åˆ†ææ¡†æ¶ï¼š** æ•´åˆ CPA / CFA / CMA / æ³•è€ƒ å››å¤§é¢†åŸŸ Â· 88ä¸ªå†³ç­–æ¨¡å‹

---

## ğŸ§  æ€ç»´é“¾å¯è§†åŒ–ï¼ˆçŸ¥è¯†åº“è°ƒç”¨è¿‡ç¨‹ï¼‰

### CPA æˆæœ¬æ•ˆç›Šåˆ†æ
\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½: cpa-knowledge.md                                    â”‚
â”‚ è¯†åˆ«é—®é¢˜ç±»å‹: èŒä¸šè½¬å‹æˆæœ¬æ”¶ç›Šå†³ç­–                         â”‚
â”‚                                                              â”‚
â”‚ é€‰é¡¹A-ç•™åœ¨ç°å²—ä½:                                          â”‚
â”‚   æ˜¾æ€§æˆæœ¬: æŒç»­åŠ ç­/æ—¶é—´æ¶ˆè€—                             â”‚
â”‚   éšæ€§æˆæœ¬: èŒä¸šæˆé•¿åœæ»/æŠ€èƒ½è´¬å€¼                         â”‚
â”‚   é¢„æœŸæ”¶ç›Š: ç¨³å®šæ”¶å…¥(ä½†æœ‰è£å‘˜é£é™©)                       â”‚
â”‚                                                              â”‚
â”‚ é€‰é¡¹B-è·³æ§½:                                               â”‚
â”‚   æ˜¾æ€§æˆæœ¬: æ±‚èŒæ—¶é—´ç²¾åŠ›/å¯èƒ½çš„é™çº§                       â”‚
â”‚   éšæ€§æˆæœ¬: é€‚åº”æœŸé£é™©/æ–°ç¯å¢ƒä¸ç¡®å®šæ€§                     â”‚
â”‚   é¢„æœŸæ”¶ç›Š: å–å†³äºofferè´¨é‡                              â”‚
â”‚                                                              â”‚
â”‚ é€‰é¡¹C-ä½“åˆ¶å†…:                                             â”‚
â”‚   æ˜¾æ€§æˆæœ¬: æ‰“ç‚¹è´¹ç”¨(4-6ä¸‡)/å¤‡è€ƒæ—¶é—´                     â”‚
â”‚   éšæ€§æˆæœ¬: å¯èƒ½çš„å²—ä½ä¸åŒ¹é…                              â”‚
â”‚   é¢„æœŸæ”¶ç›Š: ç¨³å®šæ€§/æ—¶é—´ä»·å€¼(æœä¹æ™šäº”)                    â”‚
â”‚                                                              â”‚
â”‚ æˆæœ¬æ•ˆç›Šç»“è®º:                                             â”‚
â”‚   - éœ€é‡åŒ–ï¼šæ—¶é—´ä»·å€¼ã€å¥åº·ä»·å€¼ã€æœºä¼šæˆæœ¬                   â”‚
â”‚   - å»ºè®®ï¼šå»ºç«‹å®Œæ•´çš„æˆæœ¬æ”¶ç›ŠçŸ©é˜µ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### CFA å¿ƒç†åå·®æ£€æµ‹
\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½: cfa-knowledge.md                                    â”‚
â”‚                                                              â”‚
â”‚ æ£€æµ‹åˆ°çš„æ½œåœ¨åå·®:                                          â”‚
â”‚   âš ï¸ æŸå¤±åŒæ¶ (Î»=2.0):                                    â”‚
â”‚      - è¿‡åº¦æ”¾å¤§"èŠ±4-6ä¸‡"çš„æŸå¤±æ„Ÿ                          â”‚
â”‚      - å¿½è§†"è·å¾—æœä¹æ™šäº”+å¥åº·"çš„æ”¶ç›Š                      â”‚
â”‚      - æ„Ÿæ€§æŸå¤±è¢«æ”¾å¤§2å€                                  â”‚
â”‚                                                              â”‚
â”‚   âš ï¸ é”šå®šæ•ˆåº”:                                            â”‚
â”‚      - è¿‡åº¦èšç„¦åŸæœ‰å²—ä½/è¡Œä¸š                              â”‚
â”‚      - å¿½è§†"è½¬å‹å¯èƒ½å¸¦æ¥æ–°æœºä¼š"                          â”‚
â”‚                                                              â”‚
â”‚   âš ï¸ æ²‰æ²¡æˆæœ¬è°¬è¯¯:                                        â”‚
â”‚      - çº ç»“"å·²ç»ä»˜å‡ºçš„åŠªåŠ›/æ—¶é—´"                          â”‚
â”‚      - æ­£ç¡®è®¤çŸ¥ï¼šæ²‰æ²¡æˆæœ¬ä¸åº”å½±å“å½“å‰å†³ç­–                  â”‚
â”‚                                                              â”‚
â”‚   âš ï¸ ç¦€èµ‹æ•ˆåº”:                                            â”‚
â”‚      - é«˜ä¼°ç°æœ‰é€‰æ‹©çš„ä»·å€¼                                  â”‚
â”‚      - ä½ä¼°æ–°æœºä¼šçš„å¯èƒ½æ€§                                  â”‚
â”‚                                                              â”‚
â”‚ çº åå»ºè®®:                                                  â”‚
â”‚   1. ç”¨"æœºä¼šæˆæœ¬"é‡æ–°è®¡ç®—                                â”‚
â”‚   2. ç”¨"æ¦‚ç‡"è¯„ä¼°å„é€‰é¡¹æˆåŠŸå¯èƒ½æ€§                        â”‚
â”‚   3. ç”¨"æ—¶é—´ä»·å€¼"è¡¡é‡å„é€‰é¡¹åˆ©å¼Š                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### CMA æˆ˜ç•¥ç»©æ•ˆåˆ†æ
\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½: cma-knowledge.md                                    â”‚
â”‚                                                              â”‚
â”‚ SWOTåˆ†æ:                                                  â”‚
â”‚   S(ä¼˜åŠ¿): é¡¾å®¶åŠ¨åŠ›æ˜ç¡®/æœ‰å­˜æ¬¾æ”¯æ’‘/ä¸“ä¸šèƒŒæ™¯               â”‚
â”‚   W(åŠ£åŠ¿): 33å²/ç»å†æ–­æ¡£/ä½œå“é›†å¯èƒ½ä¸è¶³                   â”‚
â”‚   O(æœºä¼š): ä½“åˆ¶å†…æœºä¼š/è¡Œä¸šè½¬å‹çª—å£                        â”‚
â”‚   T(å¨èƒ): 35å²å±æœº/æ—¶é—´çª—å£æœ‰é™/è¡Œä¸šä¸‹è¡Œ                 â”‚
â”‚                                                              â”‚
â”‚ æˆ˜ç•¥é€‰æ‹©çŸ©é˜µ:                                              â”‚
â”‚                    çŸ­æœŸ(1å¹´)      ä¸­æœŸ(3å¹´)      é•¿æœŸ(5å¹´)  â”‚
â”‚   ç•™åŸå²—ä½      ğŸ”´              ğŸ”´              ğŸ”´        â”‚
â”‚   è·³æ§½          ğŸŸ¡ä¸ç¡®å®š        ğŸŸ¢å¯èƒ½å¥½        ğŸŸ¢å¯èƒ½å¥½    â”‚
â”‚   ä½“åˆ¶å†…        ğŸŸ¢              ğŸŸ¡              ğŸŸ¡          â”‚
â”‚                                                              â”‚
â”‚ ç»©æ•ˆç›®æ ‡å¯¹é½:                                              â”‚
â”‚   ç›®æ ‡1-å¤‡å­•:       å¾…ç¡®è®¤                                â”‚
â”‚   ç›®æ ‡2-èŒä¸šæˆé•¿:   å¾…ç¡®è®¤                                â”‚
â”‚   ç›®æ ‡3-å®¶åº­ç¨³å®š:   å¾…ç¡®è®¤                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### æ³•è€ƒé£é™©åº•çº¿åˆ†æ
\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½: law-exam-knowledge.md                                â”‚
â”‚                                                              â”‚
â”‚ ä¸‰æ®µè®ºæ¨ç†:                                                â”‚
â”‚   å¤§å‰æ: å‘˜å·¥æœ‰æƒé€‰æ‹©å¯¹è‡ªå·±æœ‰åˆ©çš„èŒä¸šå‘å±•è·¯å¾„            â”‚
â”‚   å°å‰æ: éœ€åœ¨æ—¶é—´çª—å£å†…åšå‡ºç†æ€§é€‰æ‹©                      â”‚
â”‚   ç»“è®º: å¯æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€ä¼˜è·¯å¾„                       â”‚
â”‚                                                              â”‚
â”‚ é£é™©è¯†åˆ«:                                                  â”‚
â”‚   âš ï¸ åŠ³åŠ¨å…³ç³»é£é™©:                                        â”‚
â”‚      - ç•™åŸå²—: è£å‘˜é£é™©(è¡Œä¸šä¸‹è¡Œ)                         â”‚
â”‚      - è·³æ§½: è¯•ç”¨æœŸä¸ç¨³å®š                                 â”‚
â”‚      - ä½“åˆ¶å†…: ç›¸å¯¹ç¨³å®šï¼Œéœ€é€šè¿‡è€ƒè¯•                       â”‚
â”‚                                                              â”‚
â”‚   âš ï¸ æ²‰æ²¡æˆæœ¬é™·é˜±:                                         â”‚
â”‚      - å·²ä»˜å‡ºçš„åŠªåŠ›ä¸åº”æˆä¸ºç»§ç»­é”™è¯¯é€‰æ‹©çš„å€Ÿå£             â”‚
â”‚      - éœ€åŒºåˆ†"æ²‰æ²¡æˆæœ¬"å’Œ"æœºä¼šæˆæœ¬"                      â”‚
â”‚                                                              â”‚
â”‚   âš ï¸ å†³ç­–æ—¶æ•ˆé£é™©:                                         â”‚
â”‚      - æ—¶é—´çª—å£æœ‰é™ï¼Œæ‹–è¶Šä¹…é£é™©è¶Šå¤§                       â”‚
â”‚      - 33å²æ˜¯é‡è¦èŠ‚ç‚¹ï¼Œéœ€æŠŠæ¡æ—¶é—´                         â”‚
â”‚                                                              â”‚
â”‚ åº•çº¿å»ºè®®:                                                  â”‚
â”‚   1. å¤‡å­•/å®¶åº­æ˜¯ç¡¬çº¦æŸï¼Œæ—¶é—´çª—å£æœ‰é™                      â”‚
â”‚   2. æ²‰æ²¡æˆæœ¬ä¸åº”æŸç¼šå†³ç­–                                 â”‚
â”‚   3. é£é™©æ’åºï¼šå®¶åº­>èŒä¸š>ç»æµ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## âš–ï¸ é€‰é¡¹å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | é€‰é¡¹A-ç•™åŸå²— | é€‰é¡¹B-è·³æ§½ | é€‰é¡¹C-ä½“åˆ¶å†… |
|------|-------------|------------|--------------|
| **CPA-è´¢åŠ¡æ”¶ç›Š** | å¹´è–ªXXä¸‡ | å¾…å®š | å¹´è–ªXX-4~6ä¸‡ |
| **CPA-æ—¶é—´æˆæœ¬** | ğŸ”´é«˜(åŠ ç­) | ğŸŸ¡ä¸­(é€‚åº”) | ğŸŸ¢ä½(æœä¹æ™šäº”) |
| **CPA-éšæ€§æ”¶ç›Š** | ğŸŸ¡ç†Ÿæ‚‰ç¯å¢ƒ | ğŸŸ¡å¯èƒ½æˆé•¿ | ğŸŸ¢å¥åº·+æ—¶é—´ |
| **CFA-é£é™©ç¨‹åº¦** | ğŸ”´é«˜(è£å‘˜) | ğŸ”´ä¸­é«˜ | ğŸŸ¢ä½(ç¨³å®š) |
| **CFA-æˆåŠŸæ¦‚ç‡** | <20%(è¡Œä¸š) | å¾…è¯„ä¼° | ğŸŸ¡50%(éœ€è€ƒè¯•) |
| **CMA-çŸ­æœŸç›®æ ‡** | ğŸŸ¡ä¸€èˆ¬ | ğŸŸ¡å¾…è¯„ä¼° | ğŸŸ¢åŒ¹é… |
| **CMA-ä¸­æœŸæˆé•¿** | ğŸ”´æ—  | ğŸŸ¢å¯èƒ½ | ğŸŸ¡ä¸€èˆ¬ |
| **æ³•è€ƒ-é£é™©ç­‰çº§** | ğŸ”´é«˜ | ğŸŸ¡ä¸­ | ğŸŸ¢ä½ |
| **æ³•è€ƒ-åº•çº¿** | è£å‘˜é£é™© | è¯•ç”¨æœŸ | è€ƒè¯•+æ‰“ç‚¹ |

---

## ğŸ¯ ç»¼åˆç»“è®º

### å„é¢†åŸŸä¼˜å…ˆçº§æ’åºï¼ˆå¾…æ ¹æ®æ‚¨çš„å›ç­”ç»†åŒ–ï¼‰

| ä¼˜å…ˆçº§ | é¢†åŸŸ | åˆæ­¥åˆ¤æ–­ |
|--------|------|----------|
| **1** | æ³•è€ƒåº•çº¿ | å®¶åº­/å¤‡å­•æ˜¯ç¡¬çº¦æŸ |
| **2** | CPAæˆæœ¬ | æ—¶é—´ä»·å€¼ > ç»æµæˆæœ¬ |
| **3** | CMAæˆ˜ç•¥ | éœ€æ˜ç¡®ç›®æ ‡ä¼˜å…ˆçº§ |
| **4** | CFAå¿ƒç† | éœ€çº æ­£è®¤çŸ¥åå·® |

### æ¨èé€‰æ‹©ï¼ˆå¾…ç»†åŒ–ï¼‰

**å»ºè®®æ ¹æ®æ‚¨çš„å…·ä½“å›ç­”è¿›è¡Œæ·±åº¦åˆ†æåç¡®å®šã€‚**

### å…³é”®æé†’ï¼ˆå¾…ç¡®è®¤ï¼‰

1. **éœ€æ˜ç¡®**ï¼šå¤‡å­•/èŒä¸šå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜ï¼Ÿ
2. **éœ€äº†è§£**ï¼šä½“åˆ¶å†…å²—ä½çš„å…·ä½“æƒ…å†µ
3. **éœ€è¯„ä¼°**ï¼šå®¶åº­ç»æµèƒ½å¦æ‰¿å—çŸ­æœŸæ³¢åŠ¨

---

## ğŸ¤” å¾…ç”¨æˆ·ç¡®è®¤ï¼ˆè‹æ ¼æ‹‰åº•å¼æé—®ï¼‰

1. **æ ¸å¿ƒé—®é¢˜**ï¼šå¤‡å­•å’ŒèŒä¸šå‘å±•ï¼Œå¦‚æœåªèƒ½äºŒé€‰ä¸€ï¼Œé€‰å“ªä¸ªï¼Ÿ
2. **æ—¶é—´è®¡ç®—**ï¼šå„é€‰é¡¹çš„æ—¶é—´å‘¨æœŸå¤§æ¦‚æ˜¯å¤šä¹…ï¼Ÿ
3. **ç»æµè¯„ä¼°**ï¼šå®¶åº­èƒ½æ‰¿å—çš„æœ€å¤§ç»æµå‹åŠ›æ˜¯å¤šå°‘ï¼Ÿ
4. **é£é™©åº•çº¿**ï¼šæœ€åæƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¦æ¥å—ï¼Ÿ

---

*è¯·å›ç­”ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘å°†è¿›å…¥è¿­ä»£ä¼˜åŒ–é˜¶æ®µï¼Œæ·±åŒ–åˆ†æã€‚*
            `;
        }

        function generateIterationRound(message) {
            return `
## ğŸ”„ ROUND 3ï¼šè¿­ä»£ä¼˜åŒ–

æ„Ÿè°¢æ‚¨çš„è¡¥å……ï¼è®©æˆ‘æ ¹æ®æ–°ä¿¡æ¯æ›´æ–°åˆ†æï¼š

### æ›´æ–°è¦ç‚¹

- æ–°å¢ä¿¡æ¯ï¼š${extractKeyPoints(message)}
- è°ƒæ•´æ¨¡å—ï¼š${getAffectedModules(message)}

### é‡æ–°è¯„ä¼°

**åŸºäºæ‚¨çš„åé¦ˆï¼Œæˆ‘éœ€è¦é‡æ–°å®¡è§†ä»¥ä¸‹å‡ ä¸ªå‡è®¾ï¼š**

1. **æ—¶é—´çº¦æŸæ˜¯å¦å˜åŒ–ï¼Ÿ**
2. **æˆæœ¬æ‰¿å—èƒ½åŠ›æ˜¯å¦è°ƒæ•´ï¼Ÿ**
3. **é£é™©åå¥½æ˜¯å¦æœ‰æ–°çš„è€ƒé‡ï¼Ÿ**

### å»ºè®®è¡ŒåŠ¨

**å¦‚æœè¿™æ˜¯æœ€ç»ˆç¡®è®¤ï¼š**

\`\`\`
â–¡ 1. æ˜ç¡®ä¼˜å…ˆçº§æ’åº
â–¡ 2. è®¾å®šå†³ç­–æ—¶é—´èŠ‚ç‚¹
â–¡ 3. å‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ
â–¡ 4. ç›‘æ§å…³é”®æŒ‡æ ‡
\`\`\`

**ä¸‹ä¸€æ­¥ï¼š**

- å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç»†åŒ–æŸä¸ªç»´åº¦ï¼Œè¯·å‘Šè¯‰æˆ‘
- å¦‚æœä¿¡æ¯å·²å®Œå¤‡ï¼Œå¯ä»¥è¿›å…¥æœ€ç»ˆå†³ç­–é˜¶æ®µ

---

*è¯·å‘Šè¯‰æˆ‘ï¼Œè¿˜éœ€è¦è¡¥å……æˆ–è°ƒæ•´ä»€ä¹ˆï¼Ÿ*
            `;
        }

        function extractCoreProblem(text) {
            // Simple extraction - in production would use NLP
            const keywords = ['å·¥ä½œ', 'èŒä¸š', 'è·³æ§½', 'å¤‡å­•', 'ä½“åˆ¶å†…', 'çº ç»“', 'é€‰æ‹©', 'è½¬å‹'];
            const found = keywords.filter(k => text.includes(k));
            return found.length > 0 ?
                `å›´ç»•${found.slice(0, 2).join('ã€')}çš„å†³ç­–å›°å¢ƒ` :
                'éœ€è¦è¿›ä¸€æ­¥æ˜ç¡®æ ¸å¿ƒçŸ›ç›¾';
        }

        function extractKeyPoints(text) {
            return text.slice(0, 50) + '...';
        }

        function getAffectedModules(text) {
            const moduleMap = {
                'é’±': 'CPA',
                'æˆæœ¬': 'CPA',
                'å¤‡å­•': 'CMA',
                'æ—¶é—´': 'CMA',
                'é£é™©': 'CFA',
                'å¿ƒç†': 'CFA',
                'æ³•å¾‹': 'æ³•è€ƒ',
                'åˆè§„': 'æ³•è€ƒ'
            };
            const affected = new Set();
            Object.keys(moduleMap).forEach(key => {
                if (text.includes(key)) affected.add(moduleMap[key]);
            });
            return affected.size > 0 ? Array.from(affected).join('ã€') : 'å…¨éƒ¨';
        }

        function downloadReport() {
            // Generate HTML report
            const reportHtml = generateReportHtml();

            // Create filename with date
            const date = new Date().toISOString().slice(0, 10);
            const topic = (state.problem || 'decision').slice(0, 10).replace(/[^a-zA-Z0-9]/g, '');
            const filename = `report/${topic}_${date}.html`;

            // Create blob and download
            const blob = new Blob([reportHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename.replace('report/', '');
            a.click();
            URL.revokeObjectURL(url);

            alert(`æŠ¥å‘Šå·²ä¿å­˜ä¸º: ${filename.replace('report/', '')}\n\næç¤ºï¼šæ‚¨å¯ä»¥æ‰‹åŠ¨å°†å…¶ç§»åŠ¨åˆ° report æ–‡ä»¶å¤¹ä¸­ã€‚`);
        }

        function generateReportHtml() {
            const messages = document.querySelectorAll('.message');
            let content = '';
            messages.forEach(msg => {
                content += msg.innerHTML + '\n\n';
            });

            return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å†³ç­–åˆ†ææŠ¥å‘Š</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 1000px; margin: 0 auto; padding: 40px 20px; background: #f8fafc; }
        h1 { color: #1e293b; }
        h2 { color: #2563eb; margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: left; }
        th { background: #f1f5f9; }
        .system { background: #eff6ff; border-left: 4px solid #2563eb; padding: 20px; margin: 20px 0; border-radius: 0 12px 12px 0; }
        .user { background: #f1f5f9; padding: 16px; border-radius: 12px; margin: 10px 0; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #64748b; font-size: 0.9rem; }
    </style>
</head>
<body>
    <h1>ğŸ“Š å†³ç­–åˆ†ææŠ¥å‘Š</h1>
    <p><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong>${new Date().toLocaleString('zh-CN')}</p>
    <hr>
    ${content}
    <div class="footer">
        <p>æœ¬æŠ¥å‘Šç”±å¤šç»´åº¦å†³ç­–åˆ†æä¸“å®¶ç”Ÿæˆ</p>
        <p>æ•´åˆ CPA / CFA / CMA / æ³•è€ƒ å››å¤§é¢†åŸŸä¸“ä¸šçŸ¥è¯†</p>
    </div>
</body>
</html>`;
        }

        function copyReport() {
            const messages = document.querySelectorAll('.message-content');
            let text = '';
            messages.forEach(msg => {
                text += msg.innerText + '\n\n';
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function startOver() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰çš„å¯¹è¯è®°å½•å°†è¢«æ¸…é™¤ã€‚')) {
                state = {
                    round: 0,
                    currentPhase: 'intro',
                    questions: [],
                    userAnswers: [],
                    analysis: { round1: null, round2: null, round3: null },
                    options: [],
                    reportData: []
                };
                document.getElementById('chatMessages').innerHTML = '';
                addMessage('system', 'å†³ç­–åˆ†æä¸“å®¶', introMessage);
                document.getElementById('downloadBtn').disabled = true;
                document.getElementById('copyBtn').disabled = true;
                updateUI();
            }
        }
    </script>
</body>
</html>
